### **Тема 3.3: Работа с файлами в Python. Чтение и запись**

#### **1. Введение: Базовый принцип работы с файлами**
Работа с файлами состоит из трех этапов:
1. **Открытие файла** — получение доступа к файлу через файловый объект
2. **Чтение или запись** — выполнение операций с содержимым
3. **Закрытие файла** — освобождение системных ресурсов

#### **2. Конструкция `with open(...) as f` (менеджер контекста)**
**Проблема:** Если забыть закрыть файл методом `.close()`, могут возникнуть утечки ресурсов и блокировки файла.

**Решение:** Использование менеджера контекста (`with`) — **рекомендуемый подход**!
*   Файл автоматически закрывается при выходе из блока `with`
*   Даже если произойдет ошибка, файл будет корректно закрыт

**Синтаксис:**
```python
with open('файл.txt', 'режим') as файловая_переменная:
    # работа с файлом внутри этого блока
    данные = файловая_переменная.read()
# здесь файл уже автоматически закрыт
```

#### **3. Режимы открытия файла**
Второй аргумент функции `open()` определяет режим работы:

| Режим | Описание | Особенности |
|-------|----------|-------------|
| `'r'` | **read** — чтение (по умолчанию) | Файл должен существовать. Нельзя записывать. |
| `'w'` | **write** — запись | Создает файл, если его нет. **Удаляет содержимое** существующего файла! |
| `'a'` | **append** — добавление в конец | Создает файл, если его нет. Добавляет данные в конец файла, не удаляя старое содержимое. |
| `'r+'` | чтение и запись | Файл должен существовать. Можно читать и писать. |
| `'x'` | эксклюзивное создание | Создает файл, но **вызывает ошибку**, если файл уже существует. |

**Дополнения (используются с основными режимами):**
*   `'t'` — текстовый режим (по умолчанию): `'rt'`, `'wt'`, `'at'`
*   `'b'` — бинарный режим (для изображений, архивов): `'rb'`, `'wb'`

**Примеры:**
```python
# Для чтения (файл должен существовать)
with open('данные.txt', 'r') as f:
    content = f.read()

# Для записи (создаст или перезапишет файл)
with open('отчет.txt', 'w') as f:
    f.write('Новые данные')

# Для добавления в конец
with open('журнал.log', 'a') as f:
    f.write('Новая запись\n')
```

#### **4. Методы для чтения файлов**

##### **`.read([размер])`** — чтение всего файла или части
*   Без аргументов — читает **весь файл** как одну строку
*   С аргументом `n` — читает следующее `n` символов/байт

```python
with open('текст.txt', 'r') as f:
    # Прочитать весь файл
    весь_текст = f.read()
    print(весь_текст)

with open('текст.txt', 'r') as f:
    # Прочитать первые 100 символов
    часть = f.read(100)
    print(часть)
```

##### **`.readline()`** — чтение одной строки
*   Читает файл построчно
*   Возвращает пустую строку `''` при достижении конца файла

```python
with open('текст.txt', 'r') as f:
    первая_строка = f.readline()
    вторая_строка = f.readline()
```

##### **`.readlines()`** — чтение всех строк в список
*   Возвращает **список строк**, где каждая строка заканчивается символом `\n` (кроме, возможно, последней)

```python
with open('текст.txt', 'r') as f:
    все_строки = f.readlines()
    # ['Первая строка\n', 'Вторая строка\n', 'Третья строка']
```

#### **5. Итерация по файлу (альтернатива `.readlines()`)**
**Более эффективный способ для больших файлов:**
```python
with open('текст.txt', 'r') as f:
    for line in f:  # Файловый объект — итерируемый!
        print(line.strip())  # strip() убирает лишние пробелы и \n
```

#### **6. Методы для записи в файлы**

##### **`.write(строка)`** — запись строки в файл
*   Записывает переданную строку
*   **Не добавляет автоматически перенос строки!**

```python
with open('пример.txt', 'w') as f:
    f.write('Первая строка')  # Записали
    f.write('Вторая строка')   # Будет "Первая строкаВторая строка"
    
    # Правильно с переносами:
    f.write('Первая строка\n')
    f.write('Вторая строка\n')
```

##### **`.writelines(список_строк)`** — запись списка строк
*   Каждая строка из списка записывается в файл
*   **Не добавляет автоматически переносы строк!**

```python
строки = ['Первая\n', 'Вторая\n', 'Третья\n']
with open('файл.txt', 'w') as f:
    f.writelines(строки)
```

#### **7. Практический пример: Копирование файла**
```python
# Чтение и запись одновременно
with open('исходник.txt', 'r') as source:
    with open('копия.txt', 'w') as destination:
        for line in source:
            destination.write(line)
```

#### **8. Особенности и лучшие практики**
1. **Кодировка файлов:** По умолчанию используется кодировка системы. Для русских текстов лучше явно указывать:
   ```python
   with open('файл.txt', 'r', encoding='utf-8') as f:
   ```

2. **Обработка ошибок:** Файл может не существовать
   ```python
   try:
       with open('несуществующий.txt', 'r') as f:
           content = f.read()
   except FileNotFoundError:
       print("Файл не найден!")
   ```

3. **Автоматическое закрытие:** Всегда используйте `with open()`

4. **Для больших файлов:** Используйте итерацию (`for line in f`) вместо `.read()` или `.readlines()`

---

### **Ключевые выводы:**
1. **Всегда используйте `with open() as f`** — это безопасно и гарантирует закрытие файла.
2. **Режимы открытия:**
   * `'r'` — чтение (файл должен существовать)
   * `'w'` — запись (перезаписывает файл!)
   * `'a'` — добавление в конец
3. **Основные методы:**
   * `.read()` — читает весь файл
   * `.readlines()` — возвращает список строк
   * `.write()` — записывает строку (**не добавляет `\n` автоматически**)
4. **Для чтения больших файлов** используйте итерацию: `for line in f`
5. **Указывайте кодировку** для текстовых файлов: `encoding='utf-8'`