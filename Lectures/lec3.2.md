### **Тема 3.2: Виртуальные окружения (.venv)**

#### **1. Проблема, которую решают виртуальные окружения**
**Глобальное пространство пакетов (проблема):**
*   Все пакеты, установленные через `pip install`, по умолчанию попадают в **глобальную область установки Python** на вашем компьютере.
*   Это приводит к **конфликтам версий**:
    *   **Проект A** требует `pandas==1.5.0`
    *   **Проект B** требует `pandas==2.0.0`
    *   При установке новой версии для Проекта B старая версия в глобальной области будет перезаписана, что может сломать Проект A.
*   Сложность в управлении зависимостями и воспроизведении окружения на другом компьютере или сервере.

**Решение: Изоляция через виртуальные окружения**
*   **Виртуальное окружение (virtual environment, venv)** — это изолированная копия интерпретатора Python и набор пакетов, созданная для конкретного проекта.
*   **Принцип:** Каждый проект "живет" в своей песочнице со своими собственными зависимостями, которые не влияют на глобальное пространство и на другие проекты.

#### **2. Создание виртуального окружения**
*   Стандартный модуль для создания окружений — `venv` (встроен в Python 3.3+).
*   **Команда создания:**
    ```bash
    python -m venv <путь_к_окружению>
    ```
    *   `python -m venv` — запуск модуля `venv`.
    *   `<путь_к_окружению>` — имя и расположение папки, где будет создано окружение. **Общепринятая практика** — использовать папку с именем `.venv` или `venv` внутри корня вашего проекта.

*   **Пример (в директории вашего проекта):**
    ```bash
    # Создаем окружение в папке .venv
    python -m venv .venv
    ```
    **Что создается внутри папки `.venv`?**
    *   Копия интерпретатора Python
    *   Папка `Lib/site-packages` для установки пакетов (изолированная)
    *   Скрипты для активации/деактивации окружения (в папке `Scripts` на Windows или `bin` на Linux/macOS)

*   **Важно:** Папку виртуального окружения (`.venv`) **не нужно добавлять в систему контроля версий (Git)**. Ее добавляют в `.gitignore`.

#### **3. Активация виртуального окружения**
*   Перед началом работы с проектом виртуальное окружение необходимо **активировать**.
*   Активация перенастраивает командную оболочку (терминал), чтобы команды `python` и `pip` ссылались на изолированные версии внутри вашего `.venv`, а не на глобальные.

##### **Для Windows (основной способ):**
```bash
.venv\Scripts\activate
```
*Эта команда работает в стандартной командной строке Windows (CMD) и часто работает в PowerShell.*

##### **Для PowerShell (если предыдущая не сработала):**
```bash
.venv\Scripts\Activate.ps1
```
**Если в PowerShell возникает ошибка безопасности:**
1. Запустите PowerShell от имени администратора
2. Выполните команду:
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
3. Нажмите `Y` (Yes) для подтверждения
4. Попробуйте активацию снова

##### **Для Linux и macOS:**
```bash
source .venv/bin/activate
```

##### **Признак успешной активации:**
В начале строки приглашения терминала появится имя вашего окружения (обычно в скобках).
```
(.venv) C:\Users\User\project>
# или
(.venv) user@comp:~/project$
```
**Это главный индикатор** того, что вы работаете в виртуальном окружении!

#### **4. Работа в активированном окружении**
1.  **Установка пакетов:** Все пакеты устанавливаются только в это окружение.
    ```bash
    (.venv) pip install requests pandas
    ```
2.  **Проверка:** Убедитесь, что `pip list` показывает пакеты только для этого окружения.
3.  **Создание `requirements.txt`:** Фиксируем зависимости проекта.
    ```bash
    (.venv) pip freeze > requirements.txt
    ```
4.  **Запуск скриптов:** Исполняйте код, используя интерпретатор из окружения.
    ```bash
    (.venv) python my_script.py
    ```

#### **5. Деактивация виртуального окружения**
*   Чтобы выйти из изолированного окружения и вернуться к глобальному интерпретатору Python, выполните:
    ```bash
    deactivate
    ```
    Приглашение терминала `(.venv)` исчезнет.

#### **6. Воссоздание окружения на другом компьютере**
1.  Скопируйте проект вместе с файлом `requirements.txt`.
2.  Создайте чистое виртуальное окружение в папке проекта:
    ```bash
    python -m venv .venv
    ```
3.  Активируйте его:
    ```bash
    .venv\Scripts\activate  # для Windows
    ```
4.  Установите все зависимости одной командой:
    ```bash
    pip install -r requirements.txt
    ```
    Теперь окружение идентично исходному.

---

### **Ключевые выводы:**
1.  **Виртуальные окружения — обязательная практика** для разработки на Python. Они решают проблему конфликта версий пакетов между проектами.
2.  **Стандартный рабочий процесс для Windows:**
    *   Создать: `python -m venv .venv`
    *   Активировать: `.venv\Scripts\activate`
    *   Работать (устанавливать пакеты, писать код)
    *   Зафиксировать зависимости: `pip freeze > requirements.txt`
    *   Деактивировать: `deactivate` (по завершении работы)
3.  **Папку окружения `.venv` не коммитят в Git.** В репозитории должен быть только `requirements.txt`.
4.  Файл `requirements.txt` вместе с `venv` обеспечивает **воспроизводимость** и **переносимость** проекта.